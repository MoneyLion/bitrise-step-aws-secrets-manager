title: AWS Secrets Manager
summary: Fetch secrets from AWS Secrets Manager
description: |
  Fetch secrets from AWS Secrets Manager
website: https://github.com/MoneyLion/bitrise-step-aws-secrets-manager
source_code_url: https://github.com/MoneyLion/bitrise-step-aws-secrets-manager
support_url: https://github.com/MoneyLion/bitrise-step-aws-secrets-manager/issues

type_tags:
  - utility

is_requires_admin_user: true
is_always_run: false
is_skippable: false

toolkit:
  go:
    package_name: moneylion.com/security/bitrise-step-aws-secrets-manager

inputs:
  - aws_access_key_id: $AWS_ACCESS_KEY_ID
    opts:
      title: AWS Access Key ID
      summary: AWS Access Key ID
      description: The access key ID for your AWS IAM user
      is_required: true
      is_sensitive: true
  - aws_secret_access_key: $AWS_SECRET_ACCESS_KEY
    opts:
      title: AWS Secret Access Key
      summary: AWS Secret Access Key
      description: The secret access key for your AWS IAM user
      is_required: true
      is_sensitive: true
  - aws_default_region: $AWS_DEFAULT_REGION
    opts:
      title: AWS region
      summary: AWS region
      description: The AWS region where the secrets are created
      is_required: true
      is_sensitive: true
  - aws_role_arn: $AWS_ROLE_ARN
    opts:
      title: AWS Role ARN
      summary: ARN of AWS IAM role to assume
      description: The ARN of AWS IAM role to assume. This role should have the necessary permission to read secrets from AWS Secrets Manager.
      is_required: true
      is_sensitive: true
  - secret_list:
    opts:
      title: Secret list
      summary: |
        Newline separated list of secret. Each secret is delimited with hash symbol, consisting of the secret ARN, the secret's JSON object key, and the environment variable in which to store the corresponding JSON object value in.

        Example: `arn:aws:secretsmanager:us-east-1:123456789012:secret:db-credential#username#USERNAME`.

      description: |
        The newline separated list of secrets to be fetched from AWS Secrets Manager.

        Each secret itself consists of three components:

          - The ARN of the secret. This can be either full ARN, or partial ARN, which contains only the name of the secret, without the six random character suffix.

          - The secret's JSON object key. The JSON object key for identifying the value that we want to retrieve in the secret's JSON object.

          - The environment variable to store the value in. The environment variable where the JSON object value, identified by the JSON object key, is stored in.

      is_required: true
