title: Fetch secrets from AWS Secrets Manager
summary: Fetch secrets from AWS Secrets Manager
description: |
  The main intention of this Step is to allow storage of sensitive data on AWS Secrets Manager, and fetching them on-demand during Bitrise workflow execution.

  When a workflow runs, the Step fetches a list of specified secrets from AWS Secrets Manager.

  The fetched secrets are then propagated into subsequent steps in the workflow.

  The Step uses AWS SDK for Go v2 with the default config loader. This means for authenticating with AWS, you may:

    - Use static AWS credentials via environment variable, e.g. `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`.
    - Use shared configuration files, e.g. `AWS_PROFILE`.

  Checkout the main repository README for more usage guide.

website: https://github.com/MoneyLion/bitrise-step-aws-secrets-manager
source_code_url: https://github.com/MoneyLion/bitrise-step-aws-secrets-manager
support_url: https://github.com/MoneyLion/bitrise-step-aws-secrets-manager/issues

type_tags:
  - utility

is_requires_admin_user: true
is_always_run: false
is_skippable: false

toolkit:
  go:
    package_name: moneylion.com/security/bitrise-step-aws-secrets-manager

inputs:
  - aws_access_key_id: ''
    opts:
      title: AWS access key ID
      summary: AWS access key ID
      description: The AWS Access Key ID. If you are supplying this input, ensure the variable is named exactly `AWS_ACCESS_KEY_ID`.
      is_sensitive: true

  - aws_secret_access_key: ''
    opts:
      title: AWS secret access key
      summary: AWS secret access key
      description: The AWS secret access key. If you are supplying this input, ensure the variable is named exactly `AWS_SECRET_ACCESS_KEY`.
      is_sensitive: true

  - aws_region: ''
    opts:
      title: AWS region
      summary: AWS region
      description: The AWS region to operate in. If you are supplying this input, ensure the variable is named exactly `AWS_DEFAULT_REGION` or `AWS_REGION`.

  - aws_iam_role_arn: ''
    opts:
      title: AWS IAM role ARN
      summary: The ARN of AWS IAM role to assume.
      description: The ARN of AWS IAM role to assume. This role should have the necessary permission to read secrets from AWS Secrets Manager.

  - secret_list:
    opts:
      title: Secret list
      summary: A list of secrets to fetch.
      description: |
        A newline separated list of secrets to fetch from AWS Secrets Manager.

        Each line is in the form of:

        ```
        <Secret ARN> # <JSON object key> # <Environment variable>
        ```

        For example, given the secret with an ARN `arn:aws:secret-1`, and a secret value:

        ```
        {
          "username": "admin",
          "password": "str0ngpassword"
        }
        ```

        Specifying this line in the secret list:

        ```
        arn:aws:secret-1 # username # USERNAME
        ```

        Fetches the secret, retrieves the JSON value under the key `username`, and store that value in the `USERNAME` environment variable. `$USERNAME` will now contain the value `admin`.

      is_required: true
